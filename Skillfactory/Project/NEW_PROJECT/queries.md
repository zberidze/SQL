# Проект 2

На этой странице:

1. [знакомство с датасетом](#dataset);
2. [предварительный анализ данных](#first-view);
3. [глобальный анализ показателей](#global-view).
4. [анализ кандидатов](#candidates);
5. [общий вывод](#outcome).

## <a id="dataset"></a>Знакомство с датасетом

Напоминаем, что датасет, с которым мы будем работать, уже вам знаком. Мы взяли те же данные HeadHunter, только разбили их по таблицам и перенесли в БД SQL. Такой процесс называется нормализацией (вы можете почитать про неё дополнительно, если вам понадобятся знания по проектированию баз данных).

### ER-диаграмма

![](./images/er.png)

## <a id="first-view"></a>Предварительный анализ данных

### Задание 2.1

Рассчитайте максимальный возраст (max_age) кандидата в таблице.

```sql
select
    max(age) max_age
from
    hh.candidate
```

![](./images/2.1.png)

### *Вывод*

*В базе есть один соискатель, указавший возраст 100 лет. Другому самому старшему соискателю 77 лет, так что значение в 100 лет является аномальным. Нужно будет добавить фильтр по верхней границе возраста, чтобы исключить данную аномалию из результатов.*

### Задание 2.2

Теперь давайте рассчитаем минимальный возраст (min_age) кандидата в таблице.

```sql
select
    min(age) max_age
from
    hh.candidate
```

![](./images/2.2.png)

### *Вывод*

*Самому младшему соискателю в базе данных — 14 лет. Другому самому младшему соискателю — 15 лет, причем пятнадцатилетних — двое. Данное значение не является аномальным, добавлять фильтр по нижней границе возраста не нужно.*

### Задание 2.3

Напишите запрос, который позволит посчитать, сколько (cnt) человек какого возраста (age) у нас есть.

Отсортируйте результат по возрасту в обратном порядке.

```sql
select 
    age,
    count(*) cnt
from 
    hh.candidate
group by 
    -- группируем кандидатов по возрасту
    -- чтобы применить агрегирующую функцию
    age
order by 
    age desc
```

![](./images/2.3.png)

### *Вывод*

*В нашей БД больше всего кандидатов, указавших возраст 30 лет. Их почти три тысячи. Чаще всего работу ищут люди от 22 до 38 лет (их количество обозначается четырехзначными числами). Реже всего молодые люди до 19 лет и пожилые старше 57 (их количество обозначается двухзначными числами).*

### Задание 2.4

По данным Росстата, средний возраст занятых в экономике России составляет 39.7 лет. Мы округлим это значение до 40.

Найдите количество кандидатов, которые старше данного возраста. Не забудьте отфильтровать «ошибочный» возраст 100.

```sql
select 
    count(*)
from 
    hh.candidate
where
    age between 41 and 99 
    -- Mожно было использовать два условия:
    -- `age > 40 and age < 100`
    -- Но мне кажется `between` легче считывается.
    -- (По производительности они одинаковы.)
```

![](./images/2.4.png)

### *Вывод*

*В нашей БД зарегистрировано 6263 человека старше 40 лет. Они составляют лишь малую часть, 14% от всех соискателй (всего у нас 44743 человека).*

*Поскольку людей старше сорока так мало, то можно сделать вывод, что к такому возрасту значительная часть людей находит подходящую работу.*

---

## <a id="global-view"></a>Глобальный анализ показателей

### Задание 3.1

Напишите запрос, который позволит узнать, сколько (cnt) у нас кандидатов из каждого города (city).

Отсортируйте результат по количеству в обратном порядке.

```sql
select 
    c.title city,
    count(*) cnt
from 
    hh.candidate cnd
left join
    -- присоединяем таблицу-справочник `city`
    -- по `city_id` кандидата
    hh.city c on c.id = cnd.city_id
group by 
    -- группируем кандидатов по городам
    -- чтобы применить `count`
    c.title
order by 
    cnt desc
```

![](./images/3.1.png)

### *Вывод*

*В первой десятке — самые крупные города России. Первое и второе место у двух столиц: в Москве 16622 соискателя, а в Питере — 4937. Как ни странно на третьем месте Краснодар, хотя это не город-миллионер: 1066 соискателей. Начиная с четвертого места это число опускается ниже тысячи и далее наблюдается очень плавный спад.*

*Больше всего поражает разрыв между столицами и всеми остальными городами: в Москве сосредоточены более трети всех соискателей России, а в обеих столицах вместе — почти половина. Можно предположить, что в этих городах самые большие рынки труда и созданы самые лучше условия для работы.*

### Задание 3.2

Напишите запрос, который позволит понять, каких кандидатов из Москвы устроит «проектная работа».

Формат выборки: gender, age, desirable_occupation, city, employment_type.

Отсортируйте результат по id кандидата.

```sql
select
    cnd.gender,
    cnd.age,
    cnd.desirable_occupation,
    c.title city,
    cnd.employment_type
from
    hh.candidate cnd
left join
    -- присоединяем таблицу-справочник `city`
    hh.city c on c.id = cnd.city_id
where
    -- выбираем записи московских кандидатов
    c.title = 'Москва'
    -- с текстом "проектная работа" 
    -- в колонке `employment_type`
    -- (содержимое этой колонки преобразуем
    -- к нижнему регистру, на всякий случай)
    and lower(cnd.employment_type) like '%проектная работа%'
order by
    cnd.id
```

![](./images/3.2.png)

### *Вывод*

*Согласных на проектную работу соискателей в Москве нашлось 2950 человек (несогласных - 13672). Получается что только одного из шести устраивает такой тип занятости. Для сравнения, согласных на частичную занятость в полтора раза больше — 4875 человек.*

*Корреляции по возрасту и полу среди найденных соискателей не наблюдается. Можно сделать предположение, что их объединяет общая сфера деятельности — IT сектор.*

### Задание 3.3

Данных оказалось многовато. Отфильтруйте только самые популярные IT-профессии — разработчик, аналитик, программист.

Обратите внимание, что данные названия могут быть написаны как с большой, так и с маленькой буквы.

Отсортируйте результат по городу и id кандидата.

```sql
select 
    cnd.gender,
    cnd.age,
    cnd.desirable_occupation,
    c.title city,
    cnd.employment_type
from
    hh.candidate cnd
left join 
    hh.city c on c.id = cnd.city_id
where
    -- по-прежнему ищем в Москве
    c.title = 'Москва'
    -- кандидатов согласных на проектную работу
    and lower(cnd.employment_type) like '%проектная работа%'
    -- добавляем еще одно условие: желаемая профессия это 
    -- разработчик, аналитик или программист
    -- (переводим `desirable_occupation` в нижний регистр)
    and (
        lower(desirable_occupation) like '%разработчик%'
        or lower(desirable_occupation) like '%аналитик%'
        or lower(desirable_occupation) like '%программист%'
    )
order by
    c.title, cnd.id
```

![](./images/3.3.png)

### *Вывод*

*В Москве есть 778 соискателей на должность разработчика, аналитика или программиста, согласных на проектную работу.*


### Задание 3.4

Для общей информации попробуйте выбрать номера и города кандидатов, у которых занимаемая должность совпадает с желаемой.

Формат выборки: id, city.

Отсортируйте результат по городу и id кандидата.

```sql
select
    cnd.id,
    c.title city
from
    hh.candidate cnd
left join
    -- присоденияем город
    hh.city c on c.id = cnd.city_id
where
    -- условие: занимаемая и желаемая должность должны совпадать
    cnd.desirable_occupation = cnd.current_occupation
order by 
    c.title, cnd.id
```

![](./images/3.4.png)

### *Вывод*

*Примерно 11% соискателей хотят сменить место работы, сохранив прежнюю должность. Видимо текущие условия работы их не вполне устраивают, а договориться об их улучшении не получается.*

*В зависимости от города этот показатель варьируется и может достигать даже 100%, но для 50 самых крупных по количеству соискателей городов он не поднимается выше 15%.*

### Задание 3.5

Определите количество кандидатов пенсионного возраста.

Пенсионный возраст для мужчин наступает в 65 лет, для женщин — в 60 лет.

```sql
-- отфильтровываем кандидатов, указавших возраст 100 лет
with filtered_cnd as (
    select
        *
    from
        hh.candidate
    where
        age < 100
)

select
    count(*)
from
    filtered_cnd
where
    -- выбираем мужчин 65+
    (gender = 'M' and age >= 65)
    -- или женщин 60+
    or (gender = 'F' and age >= 60)
```

![](./images/3.5.png)

### *Вывод*

*Людей пенсионного возраста в нашей базе всего лишь 75 человек. Это меньше 0.2% от общего количества. Женщин среди них 24%.*

---

## <a id="candidates"></a>Анализ кандидатов для заказчиков

### Задание 4.1

Для добывающей компании нам необходимо подобрать кандидатов из Новосибирска, Омска, Томска и Тюмени, которые готовы работать вахтовым методом.

Формат выборки: gender, age, desirable_occupation, city, employment_type, timetable_type.

Отсортируйте результат по городу и номеру кандидата.

```sql
select 
    cnd.gender,
    cnd.age,
    cnd.desirable_occupation,
    c.title city,
    cnd.employment_type,
    tt.title timetable_type
from
    hh.candidate cnd
left join
    -- присоединяем город по ключу
    hh.city c on c.id = cnd.city_id
inner join
    -- присоединяем таблицу-связку
    hh.candidate_timetable_type ctt on ctt.candidate_id = cnd.id
inner join
    -- присоединяем таблицу вариантов рабочего графика
    hh.timetable_type tt on tt.id = ctt.timetable_id
where
    -- задаем первое условие: один из четырех городов
    c.title in ('Новосибирск', 'Омск', 'Томск', 'Тюмень')
    -- задаем второе условие: рабочий график - вахтовый метод
    and tt.title = 'вахтовый метод'
order by
    c.title, cnd.id
```

![](./images/4.1.png)

### *Вывод*

*В четырех городах (Новосибирск, Омск, Томск, Тюмень) есть лишь 11 человек, согласных на вахтовую работу. Как правило это мужчины до 32 лет.*

*Cоискателй согласных работать вахтовым методом довольно мало, меньше 1% от общего числа. Полагаю, добывающая компания, для которой мы искали эту ифнормацию, знает о дефиците вахтовиков на рынке труда, ведь она даже не указала интересующие ее профессии.*

### Задание 4.2

Для заказчиков из Санкт-Петербурга нам необходимо собрать список из 10 желаемых профессий кандидатов из того же города от 16 до 21 года (в выборку включается 16 и 21, сортировка производится по возрасту) с указанием их возраста, а также добавить строку Total с общим количеством таких кандидатов.

```sql
-- выбираем желаемую профессию и возраст
with spb_yng_ocp as (
    select 
        cnd.desirable_occupation, 
        cnd.age
    from 
        hh.candidate cnd
    left join 
        hh.city c on c.id = cnd.city_id
    where 
        -- у кандидатов из СПб.
        c.title = 'Санкт-Петербург'
        -- в возрасте от 16 до 21 включительно
        and cnd.age between 16 and 21
)

(select *
from spb_yng_ocp
-- сортируем по возрасту
order by age
-- берем первые 10 строк
limit 10)

UNION ALL

-- добавляем нижний колонтитул
select 'Total', count(*) 
from spb_yng_ocp
```

![](./images/4.2.png)

### *Вывод*

*В Питере есть 161 соискатель в возрасте от 16 до 21 года включительно.*

*В основном молодежь интересуют профессии, связанные с информационными технологиями.*

---

## <a id="outcome"></a>Общий вывод

Мы познакомились с БД HeadHunter и узнали, что в ней находится информация о 44743 соискателях из 984 городов. Самому младшему из них 14 лет, самому старшему — 77 (один кандидат, указавший возраст 100 лет, был исключен из результатов). Наибольшая возрастнастная страта — 30 лет, людей пенсионного возраста - 75 человек. Мужчин в базе значительно больше, чем женщин - 81%. Самый большой рынок труда находится в Москве. Молодежь крупных городов интересуют профессии в IT-сфере, а в городах Сибири очень мало желающих работать вахтовиками. Каждый девятый соискатель хочет сменить место работы, не меняя профессии. Информация была собрана в период с апреля 2018 года по май 2019.

Вот еще на какие вопросы можно было бы поискать ответы:
- Больше ли молодых соискателей в крупных городах?
- Каково распределение ожидаемой ЗП по городам/возрастным категориям?
- Какие специалисты являются самыми дорогими?
- Какого рода специалисты (и из каких городов) готовы к удаленной работе?
- Есть ли разница в ожидаемой ЗП у одинаковых специалистов, работающих полный рабочий день и удаленно?
- Есть ли разница в ожидаемой ЗП у одинаковых специалистов мужчин и женщин?
